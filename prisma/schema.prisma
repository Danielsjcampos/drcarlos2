generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  role      String   @default("USER")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Lead {
  id           String        @id @default(cuid())
  accessCode   String?       @unique @default(cuid())
  name         String
  phone        String
  email        String?
  origin       String?
  interest     String?
  status       String        @default("NEW")
  
  // Patient Details
  birthDate    DateTime?
  gender       String?
  occupation   String?
  painHistory  String?
  medicalHistory String?
  photos       String[]      @default([])
  
  appointments Appointment[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  notes        String?
}

model BlockedSlot {
  id        String   @id @default(cuid())
  dayOfWeek Int      // 0-6
  time      String   // "HH:mm"
  createdAt DateTime @default(now())
}

model BlogPost {
  id              String   @id @default(cuid())
  title           String
  slug            String   @unique
  content         String
  metaTitle       String?
  metaDescription String?
  keywords        String[]
  status          String   @default("DRAFT")
  imageUrl        String?
  audioUrl        String?
  generatedAt     DateTime @default(now())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model BlogKeyword {
  id        String   @id @default(cuid())
  term      String   @unique
  status    String   @default("PENDING") // PENDING, GENERATING, COMPLETED, FAILED
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Settings {
  id                String   @id @default("global")
  siteName          String   @default("Sport Health")
  titleTemplate     String   @default("%s | Sport Health")
  description       String?
  contactEmail      String?
  contactPhone      String?
  address           String?
  addressCity       String?
  addressRegion     String?
  addressPostalCode String?
  logoUrl           String?
  iconUrl           String?
  instagramUrl      String?
  whatsappUrl       String?
  ogImage           String?
  twitterHandle     String?
  themeColor        String   @default("#0a4d2c")
  updatedAt         DateTime @updatedAt
  openaiApiKey      String?
  
  // Google Calendar Integration
  googleAccessToken  String?
  googleRefreshToken String?
  googleTokenExpiry  BigInt?
  
  // Google OAuth Configuration (moved from env)
  googleClientId     String?
  googleClientSecret String?
  googleRedirectUri  String?
}

model Appointment {
  id          String   @id @default(cuid())
  patientName String
  phone       String
  date        DateTime
  time        String
  duration    Int      @default(60)
  type        String   @default("AVALIACAO")
  status      String   @default("SCHEDULED")
  notes       String?
  leadId      String?
  lead        Lead?    @relation(fields: [leadId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Transaction {
  id            String   @id @default(cuid())
  description   String
  amount        Float
  type          String
  category      String
  patientName   String?
  appointmentId String?
  date          DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
